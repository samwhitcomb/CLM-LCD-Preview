<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCD Device Simulator - Deutsch</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        @font-face {
            font-family: 'Acumin Pro ExtraCond Bold Italic';
            src: url('fonts/AcuminPro/Acumin-Pro-ExtraCond-Bold-Italic.ttf') format('truetype');
            font-weight: bold;
            font-style: italic;
        }
        @font-face {
            font-family: 'Barlow Light';
            src: url('fonts/Barlow_300Light.ttf') format('truetype');
            font-weight: 300;
            font-style: normal;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script>
        window.APP_LANG = 'de';
    </script>
</head>
<body>
    <div class="language-selector">
        <a href="index.html" class="lang-link">EN</a>
        <span class="lang-sep">|</span>
        <a href="Japanese.html" class="lang-link">日本語</a>
        <span class="lang-sep">|</span>
        <a href="Spanish.html" class="lang-link">Español</a>
        <span class="lang-sep">|</span>
        <a href="French.html" class="lang-link">Français</a>
        <span class="lang-sep">|</span>
        <a href="German.html" class="lang-link active">Deutsch</a>
    </div>
    <div class="container">
        <div class="device-container">
            <div class="device-image">
                <img src="Device front.png" alt="Device" class="device-bg">
                <div class="lcd-display">
                    <canvas id="lcdCanvas" width="320" height="240"></canvas>
                    <div class="lcd-overlay"></div>
                </div>
                <div class="led-light" id="ledLight"></div>

            </div>
            <div class="device-controls" id="deviceControls">
                <!-- Dynamic buttons will be inserted here -->
            </div>
            <div class="ball-counter" id="ballCounter" style="display: none;">
                <span class="ball-counter-label">Balls Placed:</span>
                <span id="ballCountDisplay" class="ball-counter-value">0</span>
            </div>
        </div>
        <div class="side-panel">
            <div class="panel-content">
                <h2>LCD Simulator (57.6mm width)</h2>
                <div class="flow-selector">
                    <label for="flowSelect">Select Flow:</label>
                    <select id="flowSelect" class="flow-select">
                        
                    </select>
                </div>
                <div class="explanation-box">
                    <h3>Current Step</h3>
                    <p id="stepExplanation">Welcome to the LCD simulator. Use the navigation buttons to explore different states.</p>
                </div>
                <div class="navigation-controls">
                    <button id="prevStep" class="nav-button">Previous</button>
                    <button id="nextStep" class="nav-button">Next</button>
                </div>
                <div class="step-indicator">
                    <span id="currentStep">1</span> / <span id="totalSteps">1</span>
                </div>
            </div>
        </div>
    </div>
    <script>
        (function() {
            const translations = {
                de: {
                    'Shutting down': 'Herunterfahren',
                    'Firmware 1.43': 'Firmware 1.43',
                    'Fw 1.43': 'Firmware 1.43',
                    'Ready': 'Bereit',
                    'Do not Disconnect': 'Nicht trennen',
                    'Firmware': 'Firmware',
                    'Update Failed': 'Update fehlgeschlagen',
                    'Unit': 'Einheit',
                    'Disconnected': 'Getrennt',
                    'Overheating': 'Überhitzt',
                    'Calibration': 'Kalibrierung',
                    'Error': 'Fehler',
                    'Contact': 'Kontakt',
                    'Support': 'Support',
                    'Welcome User!': 'Willkommen Benutzer!',
                    'Let\'s get started setting': 'Lassen Sie uns mit der Einrichtung',
                    'up your new CLM.': 'Ihres neuen CLM beginnen.',
                    'Download the': 'Laden Sie die',
                    'Rapsodo Studios Suite': 'Rapsodo Studios Suite herunter',
                    'Connect to PC using': 'Verbinden Sie mit PC über',
                    'ethernet Cable': 'Ethernet-Kabel',
                    'Connecting to Device': 'Verbinde mit Gerät',
                    'Connecting to Internet': 'Verbinde mit Internet',
                    'Connected': 'Verbunden',
                    'Connection Failed': 'Verbindung fehlgeschlagen',
                    'Internet Connection Failed': 'Internetverbindung fehlgeschlagen',
                    'Connecting to Computer': 'Verbinde mit Computer',
                    'Computer Connected': 'Computer verbunden',
                    'Internet Connected': 'Internet verbunden',
                    'Update Complete': 'Update abgeschlossen',
                    'Linking Complete': 'Verknüpfung abgeschlossen',
                    'PLACE BALL': 'BALL PLATZIEREN',
                    'MULTIPLE BALLS': 'MEHRERE BÄLLE',
                    'DETECTED': 'ERKANNT',
                    'READY': 'BEREIT'
                }
            };
            const lang = (window.APP_LANG || 'de');
            const proto = CanvasRenderingContext2D && CanvasRenderingContext2D.prototype;
            if (!proto || proto.__i18nPatched) return;
            function translate(text) {
                if (typeof text !== 'string') return text;
                const map = translations[lang];
                if (!map) return text;
                return Object.prototype.hasOwnProperty.call(map, text) ? map[text] : text;
            }
            const _fillText = proto.fillText;
            const _strokeText = proto.strokeText;
            // Group related phrases so they scale together and keep consistent font size
            const groups = {
                welcome: [
                    'Welcome User!',
                    "Let's get started setting",
                    'up your new CLM.'
                ],
                download: [
                    'Download the',
                    'Rapsodo Studios Suite'
                ],
                connect: [
                    'Connect to PC using',
                    'ethernet Cable'
                ],
                multipleBalls: [
                    'MULTIPLE BALLS',
                    'DETECTED'
                ]
            };
            function getGroupIdForText(originalText) {
                for (const key in groups) {
                    if (groups[key].includes(originalText)) return key;
                }
                return null;
            }
            function buildLines(ctx, text, maxWidth, langHint) {
                const fontMatch = (ctx.font || '').match(/(\d+(?:\.\d+)?)px/);
                const lineHeight = (fontMatch ? parseFloat(fontMatch[1]) : 14) * 1.2;
                const lines = [];
                if (!text) return { lines, lineHeight };
                const isCJK = langHint === 'ja' || !/\s/.test(text);
                if (isCJK) {
                    let current = '';
                    for (const ch of text) {
                        const next = current + ch;
                        if (ctx.measureText(next).width <= maxWidth || current.length === 0) {
                            current = next;
                        } else {
                            lines.push(current);
                            current = ch;
                        }
                    }
                    if (current) lines.push(current);
                } else {
                    const words = text.split(/\s+/);
                    let current = '';
                    for (const word of words) {
                        const candidate = current ? current + ' ' + word : word;
                        if (ctx.measureText(candidate).width <= maxWidth || current.length === 0) {
                            current = candidate;
                        } else {
                            lines.push(current);
                            current = word;
                        }
                    }
                    if (current) lines.push(current);
                }
                return { lines, lineHeight };
            }
            function drawWrapped(drawFunc, ctx, text, x, y, targetWidth) {
                const { lines, lineHeight } = buildLines(ctx, text, targetWidth, (window.APP_LANG || 'de'));
                if (lines.length === 0) return;
                for (let i = 0; i < lines.length; i++) {
                    drawFunc.call(ctx, lines[i], x, y + i * lineHeight);
                }
            }
            function fitAndDraw(drawFunc, ctx, text, x, y, maxWidth) {
                const translated = translate(text);
                if (translated === '') return;
                if (ctx && ctx.__i18nDisableAutoFit) {
                    return drawFunc.call(ctx, translated, x, y);
                }
                const canvasWidth = ctx && ctx.canvas ? ctx.canvas.width : undefined;
                const margin = 16;
                let targetWidth = maxWidth || (canvasWidth ? Math.max(0, canvasWidth - margin * 2) : undefined);
                if (canvasWidth && !maxWidth) {
                    const align = ctx.textAlign || 'left';
                    if (align === 'left') {
                        targetWidth = Math.max(0, canvasWidth - margin - x);
                    } else if (align === 'right') {
                        targetWidth = Math.max(0, x - margin);
                    } else if (align === 'center') {
                        const leftSpace = Math.max(0, x - margin);
                        const rightSpace = Math.max(0, canvasWidth - margin - x);
                        targetWidth = 2 * Math.min(leftSpace, rightSpace);
                    }
                }
                if (!targetWidth) return drawFunc.call(ctx, translated, x, y);
                const groupId = getGroupIdForText(text);
                if (groupId) {
                    // Draw wrapped to keep consistent size across lines in the group
                    drawWrapped(drawFunc, ctx, translated, x, y, targetWidth);
                    return;
                }
                // Draw wrapped for single-line cases as well
                drawWrapped(drawFunc, ctx, translated, x, y, targetWidth);
                return;
            }
            proto.fillText = function(text, x, y, maxWidth) {
                return fitAndDraw(_fillText, this, text, x, y, maxWidth);
            };
            proto.strokeText = function(text, x, y, maxWidth) {
                return fitAndDraw(_strokeText, this, text, x, y, maxWidth);
            };
            proto.__i18nPatched = true;
        })();
    </script>
    <script src="script.js"></script>
</body>
</html>
